import{q,r as h,C as N,z as O,D as K,k as U,d as r,b as a,w as l,F as x,o as d,f as n,a as o,t as _,e as y,u as p,I as W,g as M,c as z,n as F}from"./app-CZNMuXyv.js";import{_ as P}from"./SecondaryButton-BuvT1BGe.js";import{_ as v}from"./PrimaryButton-Dv3cuahV.js";import{_ as R}from"./TagBox-D1H7U3OL.js";import G from"./NewPhotoItem-XcVfsy5x.js";import Y from"./BulkTagModal-BYXA9oO-.js";import{T as H}from"./Tooltip-BZhMXdVp.js";import{_ as J}from"./TagShortcutBox-lA1C6f4w.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconDangerButton-Ck-pzSvo.js";import"./ToggleInput-DtATc2LJ.js";import"./TextInput-BUY0sAWZ.js";import"./SimpleTagShortcutItem-Bp4iMjuy.js";const X={class:"px-6 py-4 text-lg font-medium text-gray-900 dark:text-gray-100"},Z={class:"mt-4 w-full h-full min-h-96 px-4"},tt={key:0,class:"flex flex-col md:flex-row mt-6 md:mt-0 mb-4"},et={class:"ml-auto md:ml-4 mt-4 md:mt-0.5"},st={class:"flex flex-col md:flex-row mt-6 md:mt-0"},ot={class:"md:ml-4 mt-4 md:mt-0.5 ml-auto"},at={key:1,class:"mt-8"},lt={class:"mt-2"},dt={key:0,class:"flex flex-col items-end mt-8 text-sm text-red-500 dark:text-red-430"},it={key:0,class:"flex items-center px-3 text-sm text-gray-700 dark:text-gray-200"},rt={__name:"BulkTag",props:{photoIds:Array,items:Array,tags:Object,tagShortcuts:Array,tagShortcutsEnabled:Boolean},emits:["closeModalWithSuccess"],setup(m,{emit:I}){const T=m,V=I,k=q(),u=h(null),f=h(!1),s=N({items:[]}),g=h(""),c=h(null);O(()=>{window.addEventListener("keydown",C)}),K(()=>{window.removeEventListener("keydown",C)});const w=U(()=>s.processing||!s.items.length),E=()=>{s.items.unshift({key:Math.floor(Math.random()*1e5)+1,id:u.value.id,name:u.value.name,tag_ids:[],picked_up:k.props.auth.user.settings.picked_up_by_default||!1,recycled:k.props.auth.user.settings.recycled_by_default||!1,deposit:k.props.auth.user.settings.deposit_by_default||!1,quantity:1}),u.value=null},A=e=>{s.items=s.items.filter(t=>t.key!==e)},B=e=>{s.items.splice(s.items.findIndex(t=>t.key===e.key),1,e)},$=e=>{s.items.push({...e,tag_ids:[...e.tag_ids],key:Math.floor(Math.random()*1e5)+1})},b=()=>{s.transform(e=>({...e,photo_ids:T.photoIds})).post(route("bulk-photo-items.store"),{preserveScroll:!0,onSuccess:()=>L()})},D=()=>{if(c.value){for(const e of c.value.tag_shortcut_items)s.items.push({key:Math.floor(Math.random()*1e5)+1,id:e.item.id,name:e.item.name,tag_ids:e.tags.map(t=>t.id),picked_up:e.picked_up,recycled:e.recycled,deposit:e.deposit,quantity:e.quantity});c.value=null}},L=()=>{s.reset(),g.value="Tagged successfully!",setTimeout(()=>{f.value=!1,V("closeModalWithSuccess")},3e3)},S=()=>{f.value=!1,s.reset()},j=()=>{g.value="",f.value=!0},C=e=>{(e.ctrlKey||e.metaKey)&&(e.code==="Enter"||e.code==="ArrowRight")&&!w.value&&(e.preventDefault(),b())};return(e,t)=>(d(),r(x,null,[a(v,{onClick:j},{default:l(()=>t[2]||(t[2]=[n(" Tag Multiple Photos ")])),_:1}),a(Y,{"max-width":"9xl",show:f.value,onClose:S},{header:l(()=>[o("div",X," Tag Multiple Photos ("+_(m.photoIds.length)+" selected) ",1),t[3]||(t[3]=o("div",{class:"px-6 text-sm text-gray-700 dark:text-gray-200"},[n(" Add items and tags to multiple photos at once. You can also mark them as picked up, recycled, or being an item with deposit on it."),o("br"),n(" The existing items and tags of the selected photos will not be affected."),o("br"),o("br"),n(' After you have added all the items and tags, click the "Save" button to save the changes. ')],-1))]),content:l(()=>[o("div",Z,[m.tagShortcutsEnabled?(d(),r("div",tt,[a(J,{class:"w-full md:w-96",modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=i=>c.value=i),items:m.tagShortcuts,autofocus:!0,layout:"bulk",placeholder:"Tag Shortcuts"},null,8,["modelValue","items"]),o("div",et,[a(v,{class:"whitespace-nowrap",onClick:D,disabled:!c.value},{default:l(()=>t[4]||(t[4]=[n(" Apply Shortcut ")])),_:1},8,["disabled"])])])):y("",!0),o("div",st,[a(R,{class:"w-full md:w-96",items:m.items,modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=i=>u.value=i),autofocus:!m.tagShortcutsEnabled,placeholder:"Litter Objects"},null,8,["items","modelValue","autofocus"]),o("div",ot,[a(v,{class:"whitespace-nowrap",onClick:E,disabled:!u.value},{default:l(()=>t[5]||(t[5]=[n(" Add Object ")])),_:1},8,["disabled"])])]),p(s).items.length?(d(),r("div",at,[t[6]||(t[6]=o("h3",{class:"text-lg leading-6 font-medium text-gray-900 dark:text-gray-100"}," Litter Objects ",-1)),o("div",lt,[a(W,{tag:"ul",name:"items",role:"list",class:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},{default:l(()=>[(d(!0),r(x,null,M(p(s).items,i=>(d(),z(G,{key:i.key,"prop-item":i,tags:m.tags,onChange:B,onRemoveItem:A,onCopyItem:$},null,8,["prop-item","tags"]))),128))]),_:1})])])):y("",!0)]),p(s).hasErrors?(d(),r("div",dt,[(d(!0),r(x,null,M(p(s).errors,i=>(d(),r("p",null,_(i),1))),256))])):y("",!0)]),footer:l(()=>[g.value?(d(),r("div",it,_(g.value),1)):y("",!0),a(P,{onClick:S},{default:l(()=>t[7]||(t[7]=[n(" Cancel ")])),_:1}),a(v,{class:F(["ml-3 group relative",{"opacity-25":p(s).processing}]),disabled:w.value,onClick:b},{default:l(()=>[a(H,null,{default:l(()=>t[8]||(t[8]=[o("div",null,[o("div",{class:"whitespace-nowrap dark:text-white"},"Ctrl (⌘) + Enter"),o("div",{class:"whitespace-nowrap dark:text-white"},"Ctrl (⌘) + →")],-1)])),_:1}),t[9]||(t[9]=n(" Save "))]),_:1},8,["class","disabled"])]),_:1},8,["show"])],64))}},wt=Q(rt,[["__scopeId","data-v-118ff68f"]]);export{wt as default};
